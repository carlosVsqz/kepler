<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://postDetailView.title"
      focusComponent="form">
  <data>
    <instance id="postDc"
              class="com.escod.kepler.entity.blog.Post">
      <fetchPlan extends="_base">
        <property name="category"
                  fetchPlan="_instance_name"/>
        <property name="tags"
                  fetchPlan="_local"/>
        <property name="relatedPosts"
                  fetchPlan="_base"/>
      </fetchPlan>
      <loader/>
      <collection id="relatedPostsDc" property="relatedPosts"/>
      <collection id="tagsDc" property="tags"/>
    </instance>
    <collection id="postTagsDc"
                class="com.escod.kepler.entity.blog.PostTag"
                fetchPlan="_local">
      <loader id="tagsDl">
        <query>
          <![CDATA[select e from PostTag e]]>
        </query>
      </loader>
    </collection>
  </data>
  <facets>
    <dataLoadCoordinator auto="true"/>
  </facets>
  <actions>
    <action id="saveAction"
            type="detail_saveClose"/>
    <action id="closeAction"
            type="detail_close"/>
  </actions>

  <layout>
    <scroller height="95%" width="100%" scrollBarsDirection="BOTH">
      <tabSheet id="tabSheet" width="100%">
        <tab id="tab1" label="msg://Post.tab1.label">
          <formLayout id="form" dataContainer="postDc" width="100%">

            <textField id="nameField" property="name"/>

            <textField id="titleField" property="title"/>

            <entityPicker id="categoryField"
                          property="category">
              <actions>
                <action id="entityLookup"
                        type="entity_lookup"/>
                <action id="entityClear"
                        type="entity_clear"/>
              </actions>
            </entityPicker>

            <multiSelectComboBoxPicker property="tags" dataContainer="postDc" itemsContainer="postTagsDc">
              <actions>
                <action id="entityLookup"
                        type="entity_lookup"/>
                <action id="entityClear"
                        type="entity_clear"/>
              </actions>
            </multiSelectComboBoxPicker>

            <vbox width="100%">
              <fileStorageUploadField dataContainer="postDc"
                                      property="image"
                                      clearButtonVisible="true"
                                      fileNameVisible="true"
                                      acceptedFileTypes=".png"/>
              <image id="numberField"
                     height="100%"
                     width="100%"
                     maxWidth="10em"
                     alternateText="msg://Post.image.alt"
                     dataContainer="postDc"
                     property="image"/>
            </vbox>
            <formItem colspan="2">
              <richTextEditor id="htmlContentField" property="htmlContent"/>
            </formItem>
          </formLayout>
          <!--          </split>-->
        </tab>
        <tab id="tab3" label="msg://com.escod.kepler.entity.activity/BlogContent.header.tab">
          <vbox>
            <h3 text="msg://com.escod.kepler.entity.activity/BlogContent.header"/>
            <vbox id="content" classNames="bordered"/>
          </vbox>
        </tab>
        <tab id="tab2" label="msg://Post.tab2.label">
          <vbox>
            <hbox id="buttonsPanel" classNames="buttons-panel">
              <button action="relatedPostsDataGrid.add"/>
              <button action="relatedPostsDataGrid.exclude"/>
            </hbox>
            <dataGrid id="relatedPostsDataGrid" dataContainer="relatedPostsDc" width="100%" minHeight="20em">
              <actions>
                <action id="add" type="list_add"/>
                <action id="exclude" type="list_exclude"/>
              </actions>
              <columns>
                <column property="name"/>
                <column property="title"/>
              </columns>
            </dataGrid>
          </vbox>
        </tab>
      </tabSheet>
    </scroller>
    <hbox id="detailActions" height="5%" width="100%"
          maxWidth="100%"
          alignItems="CENTER"
          justifyContent="END">>
      <button id="saveAndCloseBtn"
              action="saveAction"/>
      <button id="closeBtn"
              action="closeAction"/>
    </hbox>
  </layout>
</view>
